"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.reducers = reducers;

var _table = require("../model/table.query");

var _order = require("../model/order.query");

var _drink = require("../model/drink.query");

var _commands = require("./commands");

function openTable(state, {
  tableNumber
}) {
  return {
    tables: [...state.tables, new _table.Table(tableNumber)]
  };
}

function closeTable(state, {
  tableNumber
}) {
  return {
    tables: state.tables.filter(table => table.number !== tableNumber)
  };
}

function placeOrder(state, {
  tableNumber,
  drinkDtos
}) {
  const newTable = Object.assign(new _table.Table(), state.tables.find(table => table.number === tableNumber));
  const newOrder = new _order.Order();
  drinkDtos.forEach(drinkDto => {
    newOrder.addDrink(new _drink.Drink(drinkDto.name));
  });
  newTable.order = newOrder;
  return {
    tables: state.tables.map(table => {
      if (table.number === tableNumber) {
        return newTable;
      }

      return table;
    })
  };
}

function amendOrder(state, {
  tableNumber,
  drinkDtos
}) {
  const newTable = Object.assign(new _table.Table(), state.tables.find(table => table.number === tableNumber));
  const newOrder = Object.assign(new _order.Order(), newTable.order);
  drinkDtos.forEach(drinkDto => {
    newOrder.replaceDrink(new _drink.Drink(drinkDto.name), drinkDto.id);
  });
  newTable.order = newOrder;
  return {
    tables: state.tables.map(table => {
      if (table.number === tableNumber) {
        return newTable;
      }

      return table;
    })
  };
}

function markDrinksServed(state, {
  tableNumber,
  drinkDtos
}) {
  const newTable = Object.assign(new _table.Table(), state.tables.find(table => table.number === tableNumber));
  const newOrder = Object.assign(new _order.Order(), newTable.order);
  drinkDtos.forEach(drinkDto => {
    newOrder.markDrinkServed(drinkDto.id);
  });
  newTable.order = newOrder;
  return {
    tables: state.tables.map(table => {
      if (table.number === tableNumber) {
        return newTable;
      }

      return table;
    })
  };
}

function reducers(state = {
  tables: []
}, action) {
  if (!action) {
    return state;
  }

  switch (action.type) {
    case _commands.COMMANDS.OPEN_TABLE:
      return openTable(state, action.payload);

    case _commands.COMMANDS.PLACE_ORDER:
      return placeOrder(state, action.payload);

    case _commands.COMMANDS.AMEND_ORDER:
      return amendOrder(state, action.payload);

    case _commands.COMMANDS.MARK_DRINKS_SERVED:
      return markDrinksServed(state, action.payload);

    case _commands.COMMANDS.CLOSE_TABLE:
      return closeTable(state, action.payload);

    default:
      return state;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdG9yZS9yZWR1Y2Vycy5qcyJdLCJuYW1lcyI6WyJvcGVuVGFibGUiLCJzdGF0ZSIsInRhYmxlTnVtYmVyIiwidGFibGVzIiwiVGFibGUiLCJjbG9zZVRhYmxlIiwiZmlsdGVyIiwidGFibGUiLCJudW1iZXIiLCJwbGFjZU9yZGVyIiwiZHJpbmtEdG9zIiwibmV3VGFibGUiLCJPYmplY3QiLCJhc3NpZ24iLCJmaW5kIiwibmV3T3JkZXIiLCJPcmRlciIsImZvckVhY2giLCJkcmlua0R0byIsImFkZERyaW5rIiwiRHJpbmsiLCJuYW1lIiwib3JkZXIiLCJtYXAiLCJhbWVuZE9yZGVyIiwicmVwbGFjZURyaW5rIiwiaWQiLCJtYXJrRHJpbmtzU2VydmVkIiwibWFya0RyaW5rU2VydmVkIiwicmVkdWNlcnMiLCJhY3Rpb24iLCJ0eXBlIiwiQ09NTUFORFMiLCJPUEVOX1RBQkxFIiwicGF5bG9hZCIsIlBMQUNFX09SREVSIiwiQU1FTkRfT1JERVIiLCJNQVJLX0RSSU5LU19TRVJWRUQiLCJDTE9TRV9UQUJMRSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUVBLFNBQVNBLFNBQVQsQ0FBbUJDLEtBQW5CLEVBQTBCO0FBQUVDLEVBQUFBO0FBQUYsQ0FBMUIsRUFBMkM7QUFDdkMsU0FBTztBQUNIQyxJQUFBQSxNQUFNLEVBQUUsQ0FBQyxHQUFHRixLQUFLLENBQUNFLE1BQVYsRUFBa0IsSUFBSUMsWUFBSixDQUFVRixXQUFWLENBQWxCO0FBREwsR0FBUDtBQUdIOztBQUVELFNBQVNHLFVBQVQsQ0FBb0JKLEtBQXBCLEVBQTJCO0FBQUVDLEVBQUFBO0FBQUYsQ0FBM0IsRUFBNEM7QUFDeEMsU0FBTztBQUNIQyxJQUFBQSxNQUFNLEVBQUVGLEtBQUssQ0FBQ0UsTUFBTixDQUFhRyxNQUFiLENBQW9CQyxLQUFLLElBQUlBLEtBQUssQ0FBQ0MsTUFBTixLQUFpQk4sV0FBOUM7QUFETCxHQUFQO0FBR0g7O0FBRUQs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VCxHQUFpQlAsUUFBakI7QUFFQSxTQUFPO0FBQ0haLElBQUFBLE1BQU0sRUFBRUYsS0FBSyxDQUFDRSxNQUFOLENBQWFvQixHQUFiLENBQWlCaEIsS0FBSyxJQUFJO0FBQzlCLFVBQUlBLEtBQUssQ0FBQ0MsTUFBTixLQUFpQk4sV0FBckIsRUFBa0M7QUFDOUIsZUFBT1MsUUFBUDtBQUNIOztBQUNELGFBQU9KLEtBQVA7QUFDSCxLQUxPO0FBREwsR0FBUDtBQVFIOztBQUVNLFNBQVNzQixRQUFULENBQWtCNUIsS0FBSyxHQUFHO0FBQUVFLEVBQUFBLE1BQU0sRUFBRTtBQUFWLENBQTFCLEVBQTBDMkIsTUFBMUMsRUFBa0Q7QUFDckQsTUFBSSxDQUFDQSxNQUFMLEVBQWE7QUFDVCxXQUFPN0IsS0FBUDtBQUNIOztBQUVELFVBQVE2QixNQUFNLENBQUNDLElBQWY7QUFDSSxTQUFLQyxtQkFBU0MsVUFBZDtBQUNJLGFBQU9qQyxTQUFTLENBQUNDLEtBQUQsRUFBUTZCLE1BQU0sQ0FBQ0ksT0FBZixDQUFoQjs7QUFDSixTQUFLRixtQkFBU0csV0FBZDtBQUNJLGFBQU8xQixVQUFVLENBQUNSLEtBQUQsRUFBUTZCLE1BQU0sQ0FBQ0ksT0FBZixDQUFqQjs7QUFDSixTQUFLRixtQkFBU0ksV0FBZDtBQUNJLGFBQU9aLFVBQVUsQ0FBQ3ZCLEtBQUQsRUFBUTZCLE1BQU0sQ0FBQ0ksT0FBZixDQUFqQjs7QUFDSixTQUFLRixtQkFBU0ssa0JBQWQ7QUFDSSxhQUFPVixnQkFBZ0IsQ0FBQzFCLEtBQUQsRUFBUTZCLE1BQU0sQ0FBQ0ksT0FBZixDQUF2Qjs7QUFDSixTQUFLRixtQkFBU00sV0FBZDtBQUNJLGFBQU9qQyxVQUFVLENBQUNKLEtBQUQsRUFBUTZCLE1BQU0sQ0FBQ0ksT0FBZixDQUFqQjs7QUFDSjtBQUNJLGFBQU9qQyxLQUFQO0FBWlI7QUFjSCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRhYmxlIH0gZnJvbSAnLi4vbW9kZWwvdGFibGUucXVlcnknO1xyXG5pbXBvcnQgeyBPcmRlciB9IGZyb20gJy4uL21vZGVsL29yZGVyLnF1ZXJ5JztcclxuaW1wb3J0IHsgRHJpbmsgfSBmcm9tICcuLi9tb2RlbC9kcmluay5xdWVyeSc7XHJcblxyXG5pbXBvcnQgeyBDT01NQU5EUyB9IGZyb20gJy4vY29tbWFuZHMnXHJcblxyXG5mdW5jdGlvbiBvcGVuVGFibGUoc3RhdGUsIHsgdGFibGVOdW1iZXIgfSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB0YWJsZXM6IFsuLi5zdGF0ZS50YWJsZXMsIG5ldyBUYWJsZSh0YWJsZU51bWJlcildXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlVGFibGUoc3RhdGUsIHsgdGFibGVOdW1iZXIgfSkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB0YWJsZXM6IHN0YXRlLnRhYmxlcy5maWx0ZXIodGFibGUgPT4gdGFibGUubnVtYmVyICE9PSB0YWJsZU51bWJlcilcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcGxhY2VPcmRlcihzdGF0ZSwgeyB0YWJsZU51bWJlciwgZHJpbmtEdG9zIH0pIHtcclxuICAgIGNvbnN0IG5ld1RhYmxlID0gT2JqZWN0LmFzc2lnbihuZXcgVGFibGUsIHN0YXRlLnRhYmxlcy5maW5kKHRhYmxlID0+IHRhYmxlLm51bWJlciA9PT0gdGFibGVOdW1iZXIpKVxyXG4gICAgY29uc3QgbmV3T3JkZXIgPSBuZXcgT3JkZXIoKVxyXG5cclxuICAgIGRyaW5rRHRvcy5mb3JFYWNoKGRyaW5rRHRvID0+IHtcclxuICAgICAgICBuZXdPcmRlci5hZGREcmluayhuZXcgRHJpbmsoZHJpbmtEdG8ubmFtZSkpXHJcbiAgICB9KVxyXG4gICAgbmV3VGFibGUub3JkZXIgPSBuZXdPcmRlclxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdGFibGVzOiBzdGF0ZS50YWJsZXMubWFwKHRhYmxlID0+IHtcclxuICAgICAgICAgICAgaWYgKHRhYmxlLm51bWJlciA9PT0gdGFibGVOdW1iZXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXdUYWJsZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0YWJsZVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFtZW5kT3JkZXIoc3RhdGUsIHsgdGFibGVOdW1iZXIsIGRyaW5rRHRvcyB9KSB7XHJcbiAgICBjb25zdCBuZXdUYWJsZSA9IE9iamVjdC5hc3NpZ24obmV3IFRhYmxlLCBzdGF0ZS50YWJsZXMuZmluZCh0YWJsZSA9PiB0YWJsZS5udW1iZXIgPT09IHRhYmxlTnVtYmVyKSlcclxuICAgIGNvbnN0IG5ld09yZGVyID0gT2JqZWN0LmFzc2lnbihuZXcgT3JkZXIsIG5ld1RhYmxlLm9yZGVyKVxyXG5cclxuICAgIGRyaW5rRHRvcy5mb3JFYWNoKGRyaW5rRHRvID0+IHtcclxuICAgICAgICBuZXdPcmRlci5yZXBsYWNlRHJpbmsobmV3IERyaW5rKGRyaW5rRHRvLm5hbWUpLCBkcmlua0R0by5pZClcclxuICAgIH0pXHJcbiAgICBuZXdUYWJsZS5vcmRlciA9IG5ld09yZGVyXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB0YWJsZXM6IHN0YXRlLnRhYmxlcy5tYXAodGFibGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGFibGUubnVtYmVyID09PSB0YWJsZU51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld1RhYmxlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRhYmxlXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gbWFya0RyaW5rc1NlcnZlZChzdGF0ZSwgeyB0YWJsZU51bWJlciwgZHJpbmtEdG9zIH0pIHtcclxuICAgIGNvbnN0IG5ld1RhYmxlID0gT2JqZWN0LmFzc2lnbihuZXcgVGFibGUsIHN0YXRlLnRhYmxlcy5maW5kKHRhYmxlID0+IHRhYmxlLm51bWJlciA9PT0gdGFibGVOdW1iZXIpKVxyXG4gICAgY29uc3QgbmV3T3JkZXIgPSBPYmplY3QuYXNzaWduKG5ldyBPcmRlciwgbmV3VGFibGUub3JkZXIpXHJcblxyXG4gICAgZHJpbmtEdG9zLmZvckVhY2goZHJpbmtEdG8gPT4ge1xyXG4gICAgICAgIG5ld09yZGVyLm1hcmtEcmlua1NlcnZlZChkcmlua0R0by5pZClcclxuICAgIH0pXHJcbiAgICBuZXdUYWJsZS5vcmRlciA9IG5ld09yZGVyXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICB0YWJsZXM6IHN0YXRlLnRhYmxlcy5tYXAodGFibGUgPT4ge1xyXG4gICAgICAgICAgICBpZiAodGFibGUubnVtYmVyID09PSB0YWJsZU51bWJlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld1RhYmxlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRhYmxlXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlZHVjZXJzKHN0YXRlID0geyB0YWJsZXM6IFtdIH0sIGFjdGlvbikge1xyXG4gICAgaWYgKCFhY3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gc3RhdGVcclxuICAgIH1cclxuXHJcbiAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XHJcbiAgICAgICAgY2FzZSBDT01NQU5EUy5PUEVOX1RBQkxFOlxyXG4gICAgICAgICAgICByZXR1cm4gb3BlblRhYmxlKHN0YXRlLCBhY3Rpb24ucGF5bG9hZClcclxuICAgICAgICBjYXNlIENPTU1BTkRTLlBMQUNFX09SREVSOlxyXG4gICAgICAgICAgICByZXR1cm4gcGxhY2VPcmRlcihzdGF0ZSwgYWN0aW9uLnBheWxvYWQpXHJcbiAgICAgICAgY2FzZSBDT01NQU5EUy5BTUVORF9PUkRFUjpcclxuICAgICAgICAgICAgcmV0dXJuIGFtZW5kT3JkZXIoc3RhdGUsIGFjdGlvbi5wYXlsb2FkKVxyXG4gICAgICAgIGNhc2UgQ09NTUFORFMuTUFSS19EUklOS1NfU0VSVkVEOlxyXG4gICAgICAgICAgICByZXR1cm4gbWFya0RyaW5rc1NlcnZlZChzdGF0ZSwgYWN0aW9uLnBheWxvYWQpXHJcbiAgICAgICAgY2FzZSBDT01NQU5EUy5DTE9TRV9UQUJMRTpcclxuICAgICAgICAgICAgcmV0dXJuIGNsb3NlVGFibGUoc3RhdGUsIGFjdGlvbi5wYXlsb2FkKVxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVxyXG4gICAgfVxyXG59Il19